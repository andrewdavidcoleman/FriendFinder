<!DOCTYPE html>
<html>
  <head>
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Bootstrap JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <meta charset="utf-8">
    <title>Survey</title>
    <link rel="stylesheet" href="">
  </head>

  <body>
    <div class="container">
      <div class="jumbotron">
        <h1>Friend Finder</h1>
        <form>
          Name: <input class="name" type="text" name="name">
          <h3>Rate your level of agreement with the following statements, with 1 being "Strongly disagree", and 5 being "Strongly agree".</h3>
          <div class="question-1">
            <h5>I like to be physically active(exercise/fitness) as a means of recreation, bodily upkeep, and personal discipline:</h5>
            <input type="radio" name="question1" value="1"> 1
            <input type="radio" name="question1" value="2"> 2
            <input type="radio" name="question1" value="3"> 3
            <input type="radio" name="question1" value="4"> 4
            <input type="radio" name="question1" value="5"> 5
          </div>
          <div class="question-2">
            <h5>I love pets:</h5>
            <input type="radio" name="question2" value="1"> 1
            <input type="radio" name="question2" value="2"> 2
            <input type="radio" name="question2" value="3"> 3
            <input type="radio" name="question2" value="4"> 4
            <input type="radio" name="question2" value="5"> 5
          </div>
          <div class="question-3">
            <h5>My spirituality and/or belief structure is very important to me:</h5>
            <input type="radio" name="question3" value="1"> 1
            <input type="radio" name="question3" value="2"> 2
            <input type="radio" name="question3" value="3"> 3
            <input type="radio" name="question3" value="4"> 4
            <input type="radio" name="question3" value="5"> 5
          </div>
          <div class="question-4">
            <h5>I like to keep my home and workspace very clean and organized:</h5>
            <input type="radio" name="question4" value="1"> 1
            <input type="radio" name="question4" value="2"> 2
            <input type="radio" name="question4" value="3"> 3
            <input type="radio" name="question4" value="4"> 4
            <input type="radio" name="question4" value="5"> 5
          </div>
          <div class="question-5">
            <h5>I am a very adventurous person who enjoys new experiences, places, and people:</h5>
            <input type="radio" name="question5" value="1"> 1
            <input type="radio" name="question5" value="2"> 2
            <input type="radio" name="question5" value="3"> 3
            <input type="radio" name="question5" value="4"> 4
            <input type="radio" name="question5" value="5"> 5
          </div>
          <div class="question-6">
            <h5>I am a very politically driven person:</h5>
            <input type="radio" name="question6" value="1"> 1
            <input type="radio" name="question6" value="2"> 2
            <input type="radio" name="question6" value="3"> 3
            <input type="radio" name="question6" value="4"> 4
            <input type="radio" name="question6" value="5"> 5
          </div>
          <div class="question-7">
            <h5>I like to watch movies with gladiators in them:</h5>
            <input type="radio" name="question7" value="1"> 1
            <input type="radio" name="question7" value="2"> 2
            <input type="radio" name="question7" value="3"> 3
            <input type="radio" name="question7" value="4"> 4
            <input type="radio" name="question7" value="5"> 5
          </div>
          <div class="question-8">
            <h5>When I have free time, I am more content to stay home and read a book or watch a movie than go out with friends:</h5>
            <input type="radio" name="question8" value="1"> 1
            <input type="radio" name="question8" value="2"> 2
            <input type="radio" name="question8" value="3"> 3
            <input type="radio" name="question8" value="4"> 4
            <input type="radio" name="question8" value="5"> 5
          </div>
          <div class="question-9">
            <h5>I have been in a Turkish prison:</h5>
            <input type="radio" name="question9" value="1"> 1
            <input type="radio" name="question9" value="2"> 2
            <input type="radio" name="question9" value="3"> 3
            <input type="radio" name="question9" value="4"> 4
            <input type="radio" name="question9" value="5"> 5
          </div>
          <div class="question-10">
            <h5>My relationship with my family is very important to me:</h5>
            <input type="radio" name="question10" value="1"> 1
            <input type="radio" name="question10" value="2"> 2
            <input type="radio" name="question10" value="3"> 3
            <input type="radio" name="question10" value="4"> 4
            <input type="radio" name="question10" value="5"> 5
          </div>
          <br>
          <!-- Button trigger modal -->
<button id="submit" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
  Submit
</button>
        </form>
        <!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="exampleModalLabel"></h3>
        </button>
      </div>
      <div class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" id="modal-done" class="btn btn-primary" data-dismiss="modal">Done</button>
      </div>
    </div>
  </div>
</div>
      </div>
      </div>
    </div>
  </body>

</html>

<script type="text/javascript">


  // when user files out the survey and hits submit, this happens
  $("#submit").on("click", function(event) {
    event.preventDefault();
    $('#myModal').modal('show');

    // object to hold user input
    var newFriend = {
      name: $(".name").val().trim(),
      // photo: $(".photo"),
      scores: [
        $( "input[name=question1]:checked" ).val(),
        $( "input[name=question2]:checked" ).val(),
        $( "input[name=question3]:checked" ).val(),
        $( "input[name=question4]:checked" ).val(),
        $( "input[name=question5]:checked" ).val(),
        $( "input[name=question6]:checked" ).val(),
        $( "input[name=question7]:checked" ).val(),
        $( "input[name=question8]:checked" ).val(),
        $( "input[name=question9]:checked" ).val(),
        $( "input[name=question10]:checked" ).val()
      ]
    };

    console.log(newFriend);

    // post our newFriend object to the server
    $.post("/api/friends", newFriend, function(data) {
      // log when we get a confirmation back from the server
      if (data) {
        console.log(newFriend.name + " added!");
        // console.log(newFriend);
      } else {
        console.log("something's wrong:/");
      }

      // clear the input fields
      $(".name").val("");
      $(".photo").val("");

    });

    // gather all the friend objects from the server
    $.get("/api/friends", function(data) {

      var compatibility = 0;
      var compArr = [];

      for (var i = 0; i < data.length-1; i++) { //loop through the object of all friends
        var person = data[i]; //variable that will hold each friend during their iteration
        console.log(person); //log each friend object as it loops
        console.log(person.scores); //and an array with their respective answers to each question

        for (var j = 0; j < person.scores.length; j++) { //loop through each friends answers
          var difference = parseInt(newFriend.scores[j])-parseInt(person.scores[j]);// variable holding the difference in the users answers and everyone elses

          if (difference >=0) { //if the difference is a positive number or zero
            var fromZero = difference; //reassign it to a variable called fromZero
          } else if (difference < 0) { //if the difference is a negative number
            var fromZero = -difference; //convert it to positive and reassign it to fromZero
          }
          compatibility = compatibility+fromZero; //add each fromZero to the compatibilty variable
        };

        console.log("Total compatibility score with " + person.name + ": " + compatibility);
        compArr.push(compatibility)
        // console.log(compArr);
        lowestDiff = Math.min(...compArr);
        // console.log(lowestDiff);
        compatibility = 0;

      };
      var matchIndex = compArr.indexOf(lowestDiff)
      // console.log(matchIndex);
      var winner = data[matchIndex];
      console.log("Your new friend is " + winner.name + "!");

      $(".modal-title").html("Your new friend is:<br>" + winner.name);
      $(".modal-body").html(winner.name + " likes mojitos and long walks on the beach. You will be great together.");

    });

  });

</script>
